<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XOM TV</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #1e3c72, #2a5298); color: #fff; min-height: 100vh; }
    .header { background: rgba(0,0,0,0.3); padding: 20px; text-align: center; }
    .header h1 { font-size: 2.5em; color: #4ecca3; margin-bottom: 10px; }
    .nav-buttons { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; padding: 15px; position: relative; }
    .nav-btn { background: #4ecca3; color: #1e3c72; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; font-weight: bold; transition: all 0.3s; position: relative; }
    .nav-btn:hover, .nav-btn.active { background: #45b393; transform: scale(1.05); }
    .dropdown-menu { position: absolute; top: 100%; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.9); border-radius: 10px; padding: 10px; min-width: 200px; z-index: 1000; margin-top: 5px; display: none; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    .dropdown-menu.show { display: block; }
    .dropdown-item { padding: 10px 15px; cursor: pointer; border-radius: 5px; transition: all 0.2s; margin: 2px 0; background: rgba(255,255,255,0.1); }
    .dropdown-item:hover { background: rgba(78,204,163,0.3); transform: translateX(5px); }
    .dropdown-item.active { background: rgba(78,204,163,0.5); font-weight: bold; }
    .container { display: flex; height: calc(100vh - 260px); padding: 0 20px 20px 20px; gap: 20px; }
    .channel-list { width: 280px; background: rgba(0,0,0,0.4); overflow-y: auto; border-radius: 10px; padding: 10px; }
    .video-container { flex: 1; background: #000; border-radius: 10px; overflow: hidden; display: flex; flex-direction: column; }
    .video-header { background: rgba(0,0,0,0.8); padding: 15px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
    .video-title { font-size: 1.3em; color: #4ecca3; }
    .video-controls { display: flex; gap: 10px; flex-wrap: wrap; }
    .btn { background: #4ecca3; color: #1e3c72; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 0.9em; font-weight: bold; transition: all 0.3s; }
    .btn:hover { background: #45b393; }
    .ua-selector { padding: 5px 0; font-size: 0.9em; }
    .ua-selector select { background: rgba(255,255,255,0.2); color: white; border: 1px solid #4ecca3; padding: 5px 10px; border-radius: 3px; cursor: pointer; }
    .video-wrapper { flex: 1; position: relative; background: #000; display: flex; align-items: center; justify-content: center; }
    video, iframe { width: 100%; height: 100%; object-fit: contain; border: none; }
    .error-msg { text-align: center; padding: 40px; }
    .category-title { font-weight: bold; font-size: 1.1em; padding: 10px; color: #4ecca3; border-bottom: 2px solid #4ecca3; margin: 10px 0; }
    .channel-item { padding: 10px; margin: 5px 0; cursor: pointer; border-radius: 8px; transition: all 0.2s; font-size: 0.95em; display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.1); }
    .channel-item.green  { background: rgba(40,167,69,0.8); }
    .channel-item.cyan   { background: rgba(23,162,184,0.8); }
    .channel-item.orange { background: rgba(253,126,20,0.8); }
    .channel-item.purple { background: rgba(111,66,193,0.8); }
    .channel-item.blue   { background: rgba(0,123,255,0.8); }
    .channel-item.pink   { background: rgba(232,62,140,0.8); }
    .channel-item.grey   { background: rgba(108,117,125,0.8); }
    .channel-item.yellow { background: rgba(255,193,7,0.8); }
    .channel-item.maroon { background: rgba(128,0,0,0.8); }
    .channel-item.brown  { background: rgba(139,69,19,0.8); }
    .channel-item.magenta{ background: rgba(255,0,255,0.8); }
    .channel-item.beige  { background: rgba(245,245,220,0.8); color: #333; }
    .channel-item:hover  { opacity: 0.8; transform: translateX(5px); }
    .channel-item.active { box-shadow: 0 0 15px rgba(78,204,163,0.8); font-weight: bold; }
    .fav-btn { background: none; border: none; color: #ffd700; cursor: pointer; font-size: 1.2em; }
    .tag { font-size: 0.7em; opacity: 0.8; margin-left: 4px; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-thumb { background: #4ecca3; border-radius: 4px; }
    .close-btn { display: none; position: fixed; top: 20px; right: 20px; z-index: 1001; background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
    @media (max-width: 768px) {
      .container { flex-direction: column; height: auto; }
      .channel-list { position: fixed; left: 0; top: 0; width: 100%; height: 100%; z-index: 1000; border-radius: 0; padding: 20px; transform: translateX(-100%); transition: transform 0.3s ease; overflow-y: auto; }
      .channel-list.show { transform: translateX(0); }
      .close-btn { display: block; }
      .dropdown-menu { position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%); width: 90%; max-width: 300px; }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>XOM TV</h1>
    <p>Alla iranska TV-kanaler</p>
  </div>

  <div class="nav-buttons">
    <button class="nav-btn active" onclick="showAll()">Alla kanaler</button>
    <button class="nav-btn" onclick="filterCat(event,'national')">1. Nationella</button>
    <button class="nav-btn" onclick="filterCat(event,'regional')">2. Regionala</button>
    <button class="nav-btn" onclick="filterCat(event,'kurdish')">3. Kurdiska</button>
    <button class="nav-btn" id="karwan-btn" onclick="toggleDropdown(event)">4. Karwan TV ‚ñæ</button>
    <div class="dropdown-menu" id="karwan-dd">
      <div class="dropdown-item" onclick="filterKarwan('all')">Alla Karwan kanaler</div>
      <div class="dropdown-item" onclick="filterKarwan('blue')">Kids</div>
      <div class="dropdown-item" onclick="filterKarwan('purple')">Movie</div>
      <div class="dropdown-item" onclick="filterKarwan('pink')">Dubbad</div>
      <div class="dropdown-item" onclick="filterKarwan('grey')">Blandad</div>
      <div class="dropdown-item" onclick="filterKarwan('yellow')">Music</div>
      <div class="dropdown-item" onclick="filterKarwan('maroon')">Dokument√§r</div>
      <div class="dropdown-item" onclick="filterKarwan('green')">Dini</div>
      <div class="dropdown-item" onclick="filterKarwan('brown')">Kultur</div>
      <div class="dropdown-item" onclick="filterKarwan('magenta')">Srodi Dini</div>
      <div class="dropdown-item" onclick="filterKarwan('beige')">Nyhet</div>
    </div>
    <button class="nav-btn" onclick="filterCat(event,'websites')">5. Webbplatser</button>
  </div>

  <div class="container">
    <aside class="channel-list" id="channel-list">
      <button class="close-btn" onclick="toggleList()">‚úï St√§ng</button>
      <div id="ch-container"></div>
    </aside>
    <main class="video-container">
      <div class="video-header">
        <div>
          <div class="video-title" id="ch-title">V√§lj en kanal</div>
          <div class="ua-selector">UA:
            <select id="ua-select" onchange="reload()">
              <option value="">Auto</option>
              <option value="Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X)">iPhone</option>
              <option value="Mozilla/5.0 (iPad; CPU OS 14_0 like Mac OS X)">iPad</option>
              <option value="Mozilla/5.0 (Linux; Android 10)">Android</option>
            </select>
          </div>
        </div>
        <div class="video-controls">
          <button class="btn" onclick="toggleList()">üì∫ Kanaler</button>
          <button class="btn" onclick="pip()">‚ßâ PiP</button>
          <button class="btn" onclick="fs()">‚õ∂ Fullsk√§rm</button>
          <button class="btn" onclick="reload()">‚Üª Ladda om</button>
          <button class="btn" id="tv-btn" onclick="toggleTV()">üì∫ TV-l√§ge</button>
        </div>
      </div>
      <div class="video-wrapper" id="vwrap">
        <div class="error-msg"><h3>üëà V√§lj en kanal</h3></div>
      </div>
    </main>
  </div>

<script>
  const channels = {
    national: [
      // FIXAD TV1 EXTRA - Anv√§nder parsatv.com iframe (fungerar som p√• IMVBox)
      { name: 'TV1 EXTRA', url: 'http://www.parsatv.com/embed.php?name=Shabake-1&auto=true', method: 'iframe', color: 'green' },
      
      // Backup via IMVBox ifall parsatv inte fungerar
      { name: 'TV1 (via IMVBox)', url: 'http://www.imvbox.tv/en/iribtv1/live-channel/play', method: 'iframe', color: 'blue' },
      
      // Dina befintliga kanaler
      { name: 'TV1',          url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226637/1.m3u8',        color: 'green' },
      { name: 'TV2',          url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226176/2.m3u8',        color: 'green' },
      { name: 'TV3',          url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226868/3.m3u8',        color: 'green' },
      { name: 'TV4',          url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226140/2.m3u8',        color: 'green' },
      { name: 'Tehran',       url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226141/2.m3u8',        color: 'green' },
      { name: 'Nasim',        url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226653/index.m3u8',    color: 'green' },
      { name: 'Varzesh',      url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226845/3.m3u8',        color: 'green' },
      { name: 'IRINN',        url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226142/2.m3u8',        color: 'green' },
      { name: 'IRINN 2',      url: 'https://lenz.splus.ir/PLTV/88888888/224/3221227020/2.m3u8',        color: 'green' },
      { name: 'Press TV',     url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226156/2.m3u8',        color: 'green' },
      { name: 'Al.ALAM',      url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226157/2.m3u8',        color: 'green' },
      { name: 'Al.Kothar',    url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226158/2.m3u8',        color: 'green' },
      { name: 'Omid',         url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226159/2.m3u8',        color: 'green' },
      { name: 'Namayesh',     url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226148/2.m3u8',        color: 'green' },
      { name: 'Mostanad',     url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226901/index.m3u8',    color: 'green' },
      { name: 'Tamasha',      url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226879/2.m3u8',        color: 'green' },
      { name: 'Amouzesh',     url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226151/2.m3u8',        color: 'green' },
      { name: 'Salamat',      url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226152/2.m3u8',        color: 'green' },
      { name: 'Ofogh',        url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226143/2.m3u8',        color: 'green' },
      { name: 'Quran',        url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226144/2.m3u8',        color: 'green' },
      { name: 'Pooya',        url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226145/2.m3u8',        color: 'green' },
      { name: 'Sepehr',       url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226161/2.m3u8',        color: 'green' },
      { name: 'iFilm Farsi',   url: 'https://live.presstv.ir/hls/ifilmfa.m3u8',                       color: 'blue' },
      { name: 'iFilm Dari',    url: 'https://live.presstv.ir/hls/ifilm2.m3u8',                        color: 'blue' },
      { name: 'iFilm English', url: 'https://live.presstv.ir/hls/ifilmen.m3u8',                       color: 'blue' },
      { name: 'iFilm Arabic',  url: 'https://live.presstv.ir/hls/ifilmar.m3u8',                       color: 'blue' },
      { name: 'Javaneh',      url: 'https://telewebion.ir/live/javaneh',     color: 'purple', method: 'iframe' },
      { name: 'Nava',         url: 'https://telewebion.ir/live/nava',        color: 'purple', method: 'iframe' },
      { name: 'Nama',         url: 'https://telewebion.ir/live/nama',        color: 'purple', method: 'iframe' },
      { name: 'Roya',         url: 'https://telewebion.ir/live/iribu',       color: 'purple', method: 'iframe' },
      { name: 'Nesfejahan',   url: 'https://telewebion.ir/live/nesfejahan',  color: 'purple', method: 'iframe' },
      { name: 'Sepehr (live)', url: 'https://beta.sepehrtv.ir/live/49',                               color: 'cyan', method: 'iframe' },
      { name: 'Faratar',       url: 'https://beta.sepehrtv.ir/live/196462',                            color: 'cyan', method: 'iframe' },
    ],
    regional: [
      { name: 'MAHABAD',         url: 'https://beta.sepehrtv.ir/live/15677',          color: 'cyan', method: 'iframe' },
      { name: 'MAHABAD',      url: 'https://telewebion.ir/live/mahabad',     color: 'purple', method: 'iframe' },
      { name: 'KORDESTAN',       url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226647/2.m3u8',   color: 'cyan' },
      { name: 'KORDESTAN (live)',url: 'https://sepehrtv.ir/live/kordestan',            color: 'cyan', method: 'iframe' },
      { name: 'KERMANSHAH',      url: 'https://sepehrtv.ir/live/kermanshah',           color: 'cyan', method: 'iframe' },
      { name: 'ILAM',            url: 'https://sepehrtv.ir/live/ilam',                color: 'cyan', method: 'iframe' },
      { name: 'BOOSHEHR',        url: 'https://sepehrtv.ir/live/bushehr',             color: 'cyan', method: 'iframe' },
      { name: 'ABADAN',          url: 'https://lenz.splus.ir/PLTV/88888888/224/3221227000/2.m3u8',   color: 'cyan' },
      { name: 'ABADAN (live)',   url: 'https://sepehrtv.ir/live/abadan',              color: 'cyan', method: 'iframe' },
      { name: 'BANDARABBAS',     url: 'https://sepehrtv.ir/live/khalijefars',         color: 'cyan', method: 'iframe' },
      { name: 'AHVAZ',           url: 'https://sepehrtv.ir/live/khoozestan',          color: 'cyan', method: 'iframe' },
      { name: 'KISH',            url: 'https://sepehrtv.ir/live/kish',               color: 'cyan', method: 'iframe' },
      { name: 'ZAHEDAN',         url: 'https://sepehrtv.ir/live/hamoon',             color: 'cyan', method: 'iframe' },
      { name: 'ALBORZ',          url: 'https://sepehrtv.ir/live/alborz',             color: 'cyan', method: 'iframe' },
      { name: 'ARAK',            url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226899/2.m3u8',   color: 'cyan' },
      { name: 'ARAK (live)',     url: 'https://sepehrtv.ir/live/aftab',              color: 'cyan', method: 'iframe' },
      { name: 'SEMNAN',          url: 'https://sepehrtv.ir/live/semnan',             color: 'cyan', method: 'iframe' },
      { name: 'QOM',             url: 'https://sepehrtv.ir/live/noor',               color: 'cyan', method: 'iframe' },
      { name: 'QAZVIN',          url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226888/2.m3u8',   color: 'cyan' },
      { name: 'QAZVIN (live)',   url: 'https://sepehrtv.ir/live/qazvin',             color: 'cyan', method: 'iframe' },
      { name: '4MAHAL',          url: 'https://sepehrtv.ir/live/jahanbin',           color: 'cyan', method: 'iframe' },
      { name: 'HAMADAN',         url: 'https://sepehrtv.ir/live/hamedan',            color: 'cyan', method: 'iframe' },
      { name: 'LORESTAN',        url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226675/2.m3u8',   color: 'cyan' },
      { name: 'LORESTAN (live)', url: 'https://sepehrtv.ir/live/aflak',              color: 'cyan', method: 'iframe' },
      { name: 'KERMAN',          url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226856/2.m3u8',   color: 'cyan' },
      { name: 'KERMAN (live)',   url: 'https://sepehrtv.ir/live/kerman',             color: 'cyan', method: 'iframe' },
      { name: 'ESFEHAN',         url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226652/2.m3u8',   color: 'cyan' },
      { name: 'ESFEHAN (live)',  url: 'https://sepehrtv.ir/live/esfahan',            color: 'cyan', method: 'iframe' },
      { name: 'FARS',            url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226701/2.m3u8',   color: 'cyan' },
      { name: 'FARS (live)',     url: 'https://sepehrtv.ir/live/fars',               color: 'cyan', method: 'iframe' },
      { name: 'YAZD',            url: 'https://lenz.splus.ir/PLTV/88888888/224/3221227023/2.m3u8',   color: 'cyan' },
      { name: 'YAZD (live)',     url: 'https://sepehrtv.ir/live/taban',              color: 'cyan', method: 'iframe' },
      { name: 'YASOOJ',          url: 'https://sepehrtv.ir/live/dena',               color: 'cyan', method: 'iframe' },
      { name: 'KH.JONOBI',       url: 'https://sepehrtv.ir/live/khorasanjonoobi',    color: 'cyan', method: 'iframe' },
      { name: 'KH.SHOMALI',      url: 'https://sepehrtv.ir/live/khorasanshomali',    color: 'cyan', method: 'iframe' },
      { name: 'KH.RAZAVI',       url: 'https://sepehrtv.ir/live/khorasanrazavi',     color: 'cyan', method: 'iframe' },
      { name: 'GORGAN',          url: 'https://sepehrtv.ir/live/golestan',           color: 'cyan', method: 'iframe' },
      { name: 'MAZANDARAN',      url: 'https://sepehrtv.ir/live/mazandaran',         color: 'cyan', method: 'iframe' },
      { name: 'GILAN',           url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226902/2.m3u8',   color: 'cyan' },
      { name: 'GILAN (live)',    url: 'https://sepehrtv.ir/live/baran',              color: 'cyan', method: 'iframe' },
      { name: 'ARDABIL',         url: 'https://sepehrtv.ir/live/sabalan',            color: 'cyan', method: 'iframe' },
      { name: 'TABRIZ',          url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226423/2.m3u8',   color: 'cyan' },
      { name: 'TABRIZ (live)',   url: 'https://sepehrtv.ir/live/sahand',             color: 'cyan', method: 'iframe' },
      { name: 'URMIA',           url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226800/2.m3u8',   color: 'cyan' },
      { name: 'URMIA (live)',    url: 'https://sepehrtv.ir/live/azarbayjan',         color: 'cyan', method: 'iframe' },
      { name: 'ZANJAN',          url: 'https://sepehrtv.ir/live/eshragh',            color: 'cyan', method: 'iframe' },
    ],
    kurdish: [
      { name: 'Zagros',           url: 'https://5a3ed7a72ed4b.streamlock.net/zagrostv/SMIL:myStream.smil/playlist.m3u8',                         color: 'green' },
      { name: 'Kanal8',           url: 'https://live.channel8.com/Channel8-Kurdish/index.fmp4.m3u8',                                              color: 'green' },
      { name: 'Rudaw',            url: 'https://svs.itworkscdn.net/rudawlive/rudawlive.smil/playlist.m3u8',                                       color: 'green' },
      { name: 'Kurdsat News',     url: 'https://hlspackager.akamaized.net/live/DB/KURDSAT_NEWS/HLS/KURDSAT_NEWS.m3u8',                            color: 'green' },
      { name: 'Kurdsat HD',       url: 'https://hlspackager.akamaized.net/live/DB/KURDSAT_HD/HLS/KURDSAT_HD.m3u8',                               color: 'green' },
      { name: 'Rojava HD',        url: 'https://hlspackager.akamaized.net/live/DB/ROJAVA_HD/HLS/ROJAVA_HD.m3u8',                                 color: 'green' },
      { name: 'NRT News',         url: 'https://media.streambrothers.com:1936/8226/8226/playlist.m3u8',                                           color: 'green' },
      { name: '4 Kurd',           url: 'https://4kuhls.persiana.live/hls/stream.m3u8',                                                            color: 'green' },
      { name: 'Aryen',            url: 'https://stream.aryen.tv/live/tv/chunklist_w189856026.m3u8',                                               color: 'green' },
      { name: 'Waar',             url: 'https://live.kwikmotion.com/waarmedialive/waarmedia.smil/waarmediapublish/waarmedia_source/chunks.m3u8',   color: 'green' },
      { name: 'Kurdistan TV',     url: 'https://5a3ed7a72ed4b.streamlock.net/live/SMIL:myStream.smil/playlist.m3u8',                              color: 'green' },
      { name: 'PDKI',             url: 'https://northtelecom.live/KURD.m3u8',                                                                     color: 'green' },
      { name: 'Komala',           url: 'https://live.tvkomala.com/live/komala/playlist.m3u8',                                                     color: 'green' },
      { name: 'GK',               url: 'https://live.host247.net/gk/gksat/chunklist_w624411416.m3u8',                                             color: 'green' },
      { name: 'IRIB Kurdistan',   url: 'https://telewebion.ir/live/tv-kurdistan',   color: 'green', method: 'iframe' },
      { name: 'Baxche',           url: 'https://5dcabf026b188.streamlock.net/afarinTV/livestream/playlist.m3u8',                                  color: 'green' },
      { name: 'Afarin Kids',      url: 'https://65f16f0fdfc51.streamlock.net/afarinTV/livestream/playlist.m3u8',                                  color: 'green' },
      { name: 'Zarok Kurmanci',   url: 'https://zindikurmanci.zaroktv.com.tr/hls/0/stream.m3u8',                                                 color: 'green' },
      { name: 'Zarok Sorani',     url: 'https://zindisorani.zaroktv.com.tr/hls/stream.m3u8',                                                     color: 'green' },
      { name: 'Payam TV',         url: 'https://media2.streambrothers.com:1936/8218/8218/chunklist_w1239498607.m3u8',                             color: 'green' },
      { name: 'TRT Kurd√Æ',        url: 'https://tv-trtkurdi.medya.trt.com.tr/master_1440.m3u8',                                                   color: 'green' },
      { name: 'Ava TV',           url: 'https://www.ava.news/livewatch',    method: 'external', color: 'orange' },
      { name: 'Sahar TV',         url: 'https://kurdish.sahartv.ir/live',   method: 'external', color: 'orange' },
      { name: 'UTV Hawler',       url: 'https://utvhawler.net/index.htm',   method: 'external', color: 'orange' },
    ],
    karwan: [
      { name: 'Kidco TV',           url: 'https://karwan.tv/kidco-tv',              method: 'external', color: 'blue',    subgroup: 'blue' },
      { name: 'MMN Kids',           url: 'https://karwan.tv/mmn-kids',              method: 'external', color: 'blue',    subgroup: 'blue' },
      { name: 'NRT 3 Kids',         url: 'https://karwan.tv/nrt-3-kids',            method: 'external', color: 'blue',    subgroup: 'blue' },
      { name: 'Kurdmax Pepule',     url: 'https://karwan.tv/kurdmax-pepule',        method: 'external', color: 'blue',    subgroup: 'blue' },
      { name: 'Jojo Mama',          url: 'https://karwan.tv/jojo-mama',             method: 'external', color: 'blue',    subgroup: 'blue' },
      { name: 'Astera Baby',        url: 'https://karwan.tv/astera-baby',           method: 'external', color: 'blue',    subgroup: 'blue' },
      { name: 'MMN Movies',         url: 'https://karwan.tv/mmn-movies',            method: 'external', color: 'purple',  subgroup: 'purple' },
      { name: 'Soran Entertain.',   url: 'https://karwan.tv/soran-entertainment-tv',method: 'external', color: 'purple',  subgroup: 'purple' },
      { name: 'Bnar Movies',        url: 'https://karwan.tv/bnar-movies',           method: 'external', color: 'purple',  subgroup: 'purple' },
      { name: 'Bnar TV',            url: 'https://karwan.tv/bnar-tv',               method: 'external', color: 'purple',  subgroup: 'purple' },
      { name: 'Befrin TV',          url: 'https://karwan.tv/befrin-tv',             method: 'external', color: 'purple',  subgroup: 'purple' },
      { name: 'Jamawar TV',         url: 'https://karwan.tv/jamawar-tv',            method: 'external', color: 'purple',  subgroup: 'purple' },
      { name: 'Barin Movies',       url: 'https://karwan.tv/barin-movies',          method: 'external', color: 'purple',  subgroup: 'purple' },
      { name: 'Astera Movies',      url: 'https://karwan.tv/astera-movies',         method: 'external', color: 'purple',  subgroup: 'purple' },
      { name: 'Derwaze TV',         url: 'https://karwan.tv/derwaze-tv',            method: 'external', color: 'purple',  subgroup: 'purple' },
      { name: 'Bnar Action',        url: 'https://karwan.tv/bnar-action',           method: 'external', color: 'purple',  subgroup: 'purple' },
      { name: 'MMN Drama',          url: 'https://karwan.tv/mmn-drama',             method: 'external', color: 'pink',    subgroup: 'pink' },
      { name: 'MMN Show',           url: 'https://karwan.tv/mmn-show',              method: 'external', color: 'pink',    subgroup: 'pink' },
      { name: 'Astera Show',        url: 'https://karwan.tv/astera-show',           method: 'external', color: 'pink',    subgroup: 'pink' },
      { name: 'Infinity TV',        url: 'https://karwan.tv/infinity-tv',           method: 'external', color: 'pink',    subgroup: 'pink' },
      { name: 'Astera Family',      url: 'https://karwan.tv/astera-family',         method: 'external', color: 'pink',    subgroup: 'pink' },
      { name: 'Barin Family',       url: 'https://karwan.tv/barin-family',          method: 'external', color: 'pink',    subgroup: 'pink' },
      { name: 'Srusht TV',          url: 'https://karwan.tv/srusht-tv',             method: 'external', color: 'pink',    subgroup: 'pink' },
      { name: 'Avar TV',            url: 'https://karwan.tv/avar-tv',               method: 'external', color: 'pink',    subgroup: 'pink' },
      { name: 'Halabja TV',         url: 'https://karwan.tv/halabja-tv',            method: 'external', color: 'pink',    subgroup: 'pink' },
      { name: 'Rozh TV',            url: 'https://karwan.tv/rozh-tv',               method: 'external', color: 'pink',    subgroup: 'pink' },
      { name: 'Speda Drama',        url: 'https://karwan.tv/speda-drama',           method: 'external', color: 'pink',    subgroup: 'pink' },
      { name: 'Delal TV',           url: 'https://karwan.tv/delal-tv',              method: 'external', color: 'pink',    subgroup: 'pink' },
      { name: 'Kurdmax TV',         url: 'https://karwan.tv/kurdmax-tv',            method: 'external', color: 'pink',    subgroup: 'pink' },
      { name: 'Zaxo TV',            url: 'https://karwan.tv/zaxo-tv',               method: 'external', color: 'pink',    subgroup: 'pink' },
      { name: 'Kurdmax Show',       url: 'https://karwan.tv/kurdmax-show-tv',       method: 'external', color: 'pink',    subgroup: 'pink' },
      { name: 'Mix TV',             url: 'https://karwan.tv/mix-tv',                method: 'external', color: 'pink',    subgroup: 'pink' },
      { name: 'Karwan Duhok',       url: 'https://karwan.tv/duhok-tv',              method: 'external', color: 'grey',    subgroup: 'grey' },
      { name: 'Cihan TV',           url: 'https://karwan.tv/cihan-tv',              method: 'external', color: 'grey',    subgroup: 'grey' },
      { name: 'Khak TV',            url: 'https://karwan.tv/khak-tv',               method: 'external', color: 'grey',    subgroup: 'grey' },
      { name: 'Zed TV Plus',        url: 'https://karwan.tv/zed-tv-plus',           method: 'external', color: 'grey',    subgroup: 'grey' },
      { name: 'Karwan Slemani',     url: 'https://karwan.tv/slemani-tv',            method: 'external', color: 'grey',    subgroup: 'grey' },
      { name: 'Sima TV',            url: 'https://karwan.tv/sima-tv',               method: 'external', color: 'yellow',  subgroup: 'yellow' },
      { name: 'Shna TV',            url: 'https://karwan.tv/shna-tv',               method: 'external', color: 'yellow',  subgroup: 'yellow' },
      { name: 'Kurd 7',             url: 'https://karwan.tv/kurd-7',                method: 'external', color: 'yellow',  subgroup: 'yellow' },
      { name: 'Kurdmax Music',      url: 'https://karwan.tv/kurdmax-music',         method: 'external', color: 'yellow',  subgroup: 'yellow' },
      { name: 'MMN Clip',           url: 'https://karwan.tv/mmn-clip',              method: 'external', color: 'yellow',  subgroup: 'yellow' },
      { name: 'Astera Culture',     url: 'https://karwan.tv/astera-culture',        method: 'external', color: 'yellow',  subgroup: 'yellow' },
      { name: 'Derin TV',           url: 'https://karwan.tv/derin-tv',              method: 'external', color: 'yellow',  subgroup: 'yellow' },
      { name: 'Reng TV',            url: 'https://karwan.tv/reng-tv',               method: 'external', color: 'yellow',  subgroup: 'yellow' },
      { name: 'Euro Kurd TV',       url: 'https://karwan.tv/euro-kurd-tv',          method: 'external', color: 'yellow',  subgroup: 'yellow' },
      { name: 'Kurdana TV',         url: 'https://karwan.tv/kurdana-tv',            method: 'external', color: 'yellow',  subgroup: 'yellow' },
      { name: 'Azadi TV',           url: 'https://karwan.tv/azadi-tv',              method: 'external', color: 'yellow',  subgroup: 'yellow' },
      { name: 'Kanal 21',           url: 'https://karwan.tv/kanali-21',             method: 'external', color: 'yellow',  subgroup: 'yellow' },
      { name: 'MMN Documentary',    url: 'https://karwan.tv/mmn-documentary',       method: 'external', color: 'maroon',  subgroup: 'maroon' },
      { name: 'Astera Documentary', url: 'https://karwan.tv/astera-documentary',    method: 'external', color: 'maroon',  subgroup: 'maroon' },
      { name: 'Reng Documentary',   url: 'https://karwan.tv/reng-documentary',      method: 'external', color: 'maroon',  subgroup: 'maroon' },
      { name: 'Zed TV',             url: 'https://karwan.tv/zed-tv',                method: 'external', color: 'maroon',  subgroup: 'maroon' },
      { name: 'NRT 4',              url: 'https://karwan.tv/nrt-4',                 method: 'external', color: 'green',   subgroup: 'green' },
      { name: 'Mihrab TV',          url: 'https://karwan.tv/mihrab-tv',             method: 'external', color: 'green',   subgroup: 'green' },
      { name: 'UTV Duhok',          url: 'https://karwan.tv/utv-duhok',             method: 'external', color: 'green',   subgroup: 'green' },
      { name: 'UTV Hawler',         url: 'https://karwan.tv/utv-hawler',            method: 'external', color: 'green',   subgroup: 'green' },
      { name: 'Shar TV',            url: 'https://karwan.tv/shar-tv',               method: 'external', color: 'green',   subgroup: 'green' },
      { name: 'Farmoda TV',         url: 'https://karwan.tv/farmoda-tv',            method: 'external', color: 'green',   subgroup: 'green' },
      { name: 'Ranya TV',           url: 'https://karwan.tv/ranya-tv',              method: 'external', color: 'green',   subgroup: 'green' },
      { name: 'Aro Family',         url: 'https://karwan.tv/aro-family',            method: 'external', color: 'green',   subgroup: 'green' },
      { name: 'Dever TV',           url: 'https://karwan.tv/dever-tv',              method: 'external', color: 'brown',   subgroup: 'brown' },
      { name: 'Rasan TV',           url: 'https://karwan.tv/rasan-tv',              method: 'external', color: 'brown',   subgroup: 'brown' },
      { name: 'Dimen TV',           url: 'https://karwan.tv/dimen-tv',              method: 'external', color: 'magenta', subgroup: 'magenta' },
      { name: 'Bangxwazen Badinan', url: 'https://karwan.tv/bangxwazen-badinan-tv', method: 'external', color: 'magenta', subgroup: 'magenta' },
      { name: 'Esra TV',            url: 'https://karwan.tv/esra-tv',               method: 'external', color: 'magenta', subgroup: 'magenta' },
      { name: 'Kurd Channel',       url: 'https://karwan.tv/kurd-channel',          method: 'external', color: 'beige',   subgroup: 'beige' },
      { name: 'Cira TV',            url: 'https://karwan.tv/cira-tv',               method: 'external', color: 'beige',   subgroup: 'beige' },
      { name: 'Karwan Nalia TV',    url: 'https://karwan.tv/nalia-tv',              method: 'external', color: 'beige',   subgroup: 'beige' },
      { name: 'Rojhelat TV',        url: 'https://karwan.tv/rojhelat-tv',           method: 'external', color: 'beige',   subgroup: 'beige' },
      { name: 'Speda TV',           url: 'https://karwan.tv/speda-tv',              method: 'external', color: 'beige',   subgroup: 'beige' },
      { name: 'Kirkuk TV',          url: 'https://karwan.tv/kirkuk-tv',             method: 'external', color: 'beige',   subgroup: 'beige' },
      { name: 'Ava TV',             url: 'https://karwan.tv/ava-tv',                method: 'external', color: 'beige',   subgroup: 'beige' },
    ],
    websites: [
      { name: 'IMVBox',         url: 'https://www.imvbox.com/en',              method: 'external', color: 'orange' },
      { name: 'TV.GARDEN',         url: 'https://famelack.com/ir',              method: 'external', color: 'orange' },
      { name: 'YJC',         url: 'https://www.yjc.ir/fa/live',              method: 'external', color: 'orange' },
      { name: 'YOZONLINE',         url: 'https://yozonline.ir/tv1/',              method: 'external', color: 'orange' },
      { name: 'Persianity',     url: 'https://persianity.com',                 method: 'external', color: 'orange' },
      { name: 'Parsa TV',       url: 'https://parsatv.com',                    method: 'external', color: 'orange' },
      { name: 'MDB Max',        url: 'https://mdbmax.com/',                    method: 'external', color: 'orange' },
      { name: 'FarsiPlex',      url: 'https://farsiplex.com',                  method: 'external', color: 'orange' },
      { name: 'Flnd Buzz',      url: 'https://flnd.buzz/',                     method: 'external', color: 'orange' },
      { name: 'Farsiland',      url: 'https://farsiland.com/movies',           method: 'external', color: 'orange' },
      { name: 'Persian Hive',   url: 'https://persianhive.com',                method: 'external', color: 'orange' },
      { name: 'Namakade',       url: 'https://namakade.com',                   method: 'external', color: 'orange' },
      { name: 'Telewebion',     url: 'https://telewebion.ir/',                 method: 'external', color: 'orange' },
      { name: 'Sepehr TV',      url: 'https://beta.sepehrtv.ir/',              method: 'external', color: 'orange' },
      { name: 'Sassan TV',      url: 'https://sassantv.com/',                  method: 'external', color: 'orange' },
      { name: 'Giniko TV',      url: 'https://giniko.com/watch.php?id=iran',   method: 'external', color: 'orange' },
    ]
  };

  let hlsInst = null;
  let cur = null;
  let favs = [];
  try { favs = JSON.parse(localStorage.getItem('xomfavs') || '[]'); } catch(e) { favs = []; }
  const lsOK = (function(){ try { localStorage.setItem('_t','1'); localStorage.removeItem('_t'); return true; } catch(e){ return false; } })();
  let curFilter = null;
  let curSub = 'all';

  function e(s) { return s.replace(/\\/g,'\\\\').replace(/'/g,"\\'"); }

  function render(filter, sub) {
    curFilter = filter; curSub = sub || 'all';
    const catNames = { national:'Nationella', regional:'Regionala', kurdish:'Kurdiska', karwan:'Karwan TV', websites:'Webbplatser' };
    const subNames = { all:'Alla', blue:'Kids', purple:'Movie', pink:'Dubbad', grey:'Blandad', yellow:'Music', maroon:'Dokument√§r', green:'Dini', brown:'Kultur', magenta:'Srodi Dini', beige:'Nyhet' };

    const row = ch => {
      const m = ch.method || 'hls', r = ch.referer || '';
      const badge = m==='iframe' ? ' <span class="tag">[live]</span>' : m==='external' ? ' <span class="tag">‚Üó</span>' : '';
      const star = favs.some(f=>f.url===ch.url) ? '‚≠ê' : '‚òÜ';
      return `<div class="channel-item ${ch.color}${cur&&cur.url===ch.url?' active':''}" onclick="play('${e(ch.url)}','${e(ch.name)}','${m}','${r}')">
        <span>${ch.name}${badge}</span>
        <button class="fav-btn" onclick="event.stopPropagation();fav('${e(ch.url)}','${e(ch.name)}')">${star}</button>
      </div>`;
    };

    let html = '';
    if (filter === 'karwan') {
      const list = curSub==='all' ? channels.karwan : channels.karwan.filter(c=>c.subgroup===curSub);
      html = `<div class="category-title">Karwan TV ‚Äî ${subNames[curSub]} (${list.length})</div>` + list.map(row).join('');
    } else if (filter) {
      html = `<div class="category-title">${catNames[filter]}</div>` + channels[filter].map(row).join('');
    } else {
      Object.keys(channels).forEach(cat => {
        html += `<div class="category-title">${catNames[cat]}</div>` + channels[cat].map(row).join('');
      });
    }
    document.getElementById('ch-container').innerHTML = html;
  }

  function setActive(btn) {
    document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
  }
  
  function showAll() {
    setActive(document.querySelector('.nav-btn'));
    closeDD(); render(null,'all');
  }
  
  function filterCat(ev, cat) { setActive(ev.target); closeDD(); render(cat,'all'); }
  
  function filterKarwan(sub) {
    setActive(document.getElementById('karwan-btn')); closeDD(); render('karwan', sub);
  }
  
  function toggleDropdown(e) {
    e.stopPropagation();
    const dd = document.getElementById('karwan-dd');
    if (dd.classList.contains('show')) { closeDD(); return; }
    dd.classList.add('show');
    setTimeout(()=>document.addEventListener('click', outsideDD), 10);
  }
  
  function closeDD() { document.getElementById('karwan-dd').classList.remove('show'); document.removeEventListener('click', outsideDD); }
  
  function outsideDD(e) { if (!document.getElementById('karwan-dd').contains(e.target) && !document.getElementById('karwan-btn').contains(e.target)) closeDD(); }
  
  function toggleList() { document.getElementById('channel-list').classList.toggle('show'); }

  function fav(url, name) {
    const i = favs.findIndex(f=>f.url===url);
    if (i>-1) favs.splice(i,1); else favs.push({url,name});
    if (lsOK) try { localStorage.setItem('xomfavs', JSON.stringify(favs)); } catch(e) {}
    render(curFilter, curSub);
  }

  // F√ñRB√ÑTTRAD play-funktion med b√§ttre iframe-hantering
  function play(url, name, method, referer) {
    if (window.innerWidth <= 768) document.getElementById('channel-list').classList.remove('show');
    cur = {url, name, method, referer};
    document.getElementById('ch-title').textContent = name;

    if (hlsInst) { hlsInst.destroy(); hlsInst = null; }

    if (method === 'external') { window.open(url, '_blank'); return; }

    const wrap = document.getElementById('vwrap');

    if (method === 'iframe') {
      // Smart iframe-hantering f√∂r olika k√§llor
      let iframeHtml = '';
      
      if (url.includes('parsatv.com')) {
        // Parsatv fungerar perfekt - anv√§nds av IMVBox
        iframeHtml = `<iframe src="${url}" allowfullscreen allow="autoplay; fullscreen" style="width:100%; height:100%; border:none;"></iframe>`;
      } 
      else if (url.includes('telewebion')) {
        // Telewebion beh√∂ver skalas
        iframeHtml = `<div style="width:100%;height:100%;overflow:hidden;position:relative;">
          <iframe src="${url}" allowfullscreen allow="autoplay; fullscreen" style="width:200%;height:200%;transform:scale(0.5) translateY(-12%);transform-origin:0 0;border:none;"></iframe>
        </div>`;
      }
      else if (url.includes('imvbox.tv')) {
        // IMVBox fungerar direkt
        iframeHtml = `<iframe src="${url}" allowfullscreen allow="autoplay; fullscreen" style="width:100%; height:100%; border:none;"></iframe>`;
      }
      else {
        // Standard iframe f√∂r √∂vriga
        iframeHtml = `<iframe src="${url}" allowfullscreen allow="autoplay; fullscreen" style="width:100%; height:100%; border:none;"></iframe>`;
      }
      
      wrap.innerHTML = iframeHtml;
      render(curFilter, curSub);
      return;
    }

    // HLS
    wrap.innerHTML = '<video id="vplayer" controls autoplay style="width:100%;height:100%;"></video>';
    const vid = document.getElementById('vplayer');

    if (Hls.isSupported()) {
      hlsInst = new Hls({
        enableWorker: true,
        startPosition: -1,
        liveSyncDurationCount: 3,
        maxBufferLength: 10,
        maxMaxBufferLength: 30,
        backBufferLength: 10,
        xhrSetup(xhr) {
          const ua = document.getElementById('ua-select').value;
          if (ua) try { xhr.setRequestHeader('User-Agent', ua); } catch(err){}
          if (referer) try { xhr.setRequestHeader('Referer', referer); } catch(err){}
        }
      });
      hlsInst.loadSource(url);
      hlsInst.attachMedia(vid);
      hlsInst.on(Hls.Events.MANIFEST_PARSED, () => vid.play().catch(()=>{}));
      hlsInst.on(Hls.Events.ERROR, (_, d) => {
        if (!d.fatal) return;
        if (d.type === Hls.ErrorTypes.NETWORK_ERROR) setTimeout(()=>{ if(hlsInst) hlsInst.startLoad(); }, 2000);
        else if (d.type === Hls.ErrorTypes.MEDIA_ERROR) hlsInst.recoverMediaError();
        else showErr();
      });
    } else if (vid.canPlayType('application/vnd.apple.mpegurl')) {
      vid.src = url; vid.play().catch(()=>{});
    } else {
      showErr();
    }
    render(curFilter, curSub);
  }

  function showErr() {
    document.getElementById('vwrap').innerHTML = `<div class="error-msg"><h3>‚ö†Ô∏è Kunde inte ladda stream</h3><br><button class="btn" onclick="reload()">‚Üª F√∂rs√∂k igen</button></div>`;
  }
  
  function reload() { if (cur) play(cur.url, cur.name, cur.method, cur.referer); }
  
  function pip() {
    const v = document.getElementById('vplayer');
    if (!v || !document.pictureInPictureEnabled) return;
    document.pictureInPictureElement ? document.exitPictureInPicture() : v.requestPictureInPicture().catch(()=>{});
  }
  
  function fs() {
    const w = document.getElementById('vwrap');
    document.fullscreenElement ? document.exitFullscreen() : w.requestFullscreen().catch(()=>{});
  }

  let tvMode = false;

  function toggleTV() {
    tvMode = !tvMode;
    document.body.classList.toggle('tv-mode', tvMode);
    document.getElementById('tv-btn').textContent = tvMode ? 'üñ•Ô∏è Normal' : 'üì∫ TV-l√§ge';
    if (tvMode) {
      document.documentElement.requestFullscreen && document.documentElement.requestFullscreen().catch(()=>{});
    } else {
      document.fullscreenElement && document.exitFullscreen();
    }
    if (lsOK) try { localStorage.setItem('xomtv', tvMode ? '1' : ''); } catch(e) {}
  }

  (function detectTV() {
    const ua = navigator.userAgent || '';
    const isTV = /SmartTV|webOS|SMART-TV|HbbTV|NetCast|BRAVIA|Tizen/i.test(ua) || window.innerWidth >= 1920 && ('ontouchstart' in window === false) && navigator.maxTouchPoints === 0;
    if (isTV) {
      document.body.classList.add('tv-mode');
      tvMode = true;
      document.getElementById('tv-btn').textContent = 'üñ•Ô∏è Normal';
    }
    if (lsOK) {
      try { if (localStorage.getItem('xomtv') === '1') { document.body.classList.add('tv-mode'); tvMode = true; document.getElementById('tv-btn').textContent = 'üñ•Ô∏è Normal'; } } catch(e) {}
    }
  })();

  render(null, 'all');
</script>
</body>
</html>
