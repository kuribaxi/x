<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XOM TV - Alla iranska TV-kanaler</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    /* Samma CSS som tidigare ‚Äì beh√•lls of√∂r√§ndrad (f√∂rkortad h√§r f√∂r l√§sbarhet) */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #1e3c72, #2a5298); color: #fff; min-height: 100vh; }
    .header { background: rgba(0,0,0,0.3); padding: 20px; text-align: center; }
    .header h1 { font-size: 2.5em; color: #4ecca3; margin-bottom: 10px; }
    .nav-buttons { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; padding: 15px; position: relative; }
    .nav-btn { background: #4ecca3; color: #1e3c72; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
    .nav-btn:hover, .nav-btn.active { background: #45b393; transform: scale(1.05); }
    .dropdown-menu { position: absolute; top: 100%; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.9); border-radius: 10px; padding: 10px; min-width: 200px; z-index: 1000; display: none; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    .dropdown-menu.show { display: block; }
    .dropdown-item { padding: 10px 15px; cursor: pointer; border-radius: 5px; transition: all 0.2s; margin: 2px 0; background: rgba(255,255,255,0.1); }
    .dropdown-item:hover { background: rgba(78, 204, 163, 0.3); transform: translateX(5px); }
    .dropdown-item.active { background: rgba(78, 204, 163, 0.5); font-weight: bold; }
    .server-info { text-align: center; padding: 10px; color: #ffd700; font-size: 0.9em; }
    .container { display: flex; height: calc(100vh - 250px); padding: 0 20px 20px 20px; gap: 20px; }
    .channel-list { width: 280px; background: rgba(0,0,0,0.4); overflow-y: auto; border-radius: 10px; padding: 10px; }
    @media (max-width: 768px) {
      .container { flex-direction: column; height: auto; }
      .channel-list { position: fixed; left: 0; top: 0; width: 100%; height: 100%; z-index: 1000; border-radius: 0; padding: 20px; transform: translateX(-100%); transition: transform 0.3s ease; }
      .channel-list.show { transform: translateX(0); }
      .dropdown-menu { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 300px; }
    }
    .video-container { flex: 1; background: #000; border-radius: 10px; overflow: hidden; display: flex; flex-direction: column; }
    .video-header { background: rgba(0,0,0,0.8); padding: 15px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
    .video-title { font-size: 1.3em; color: #4ecca3; }
    .video-controls { display: flex; gap: 10px; flex-wrap: wrap; }
    .btn { background: #4ecca3; color: #1e3c72; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 0.9em; font-weight: bold; transition: all 0.3s; }
    .btn:hover { background: #45b393; }
    .ua-selector { padding: 5px 0; }
    .ua-selector select { background: rgba(255,255,255,0.2); color: white; border: 1px solid #4ecca3; padding: 5px 10px; border-radius: 3px; cursor: pointer; }
    .video-wrapper { flex: 1; position: relative; background: #000; display: flex; align-items: center; justify-content: center; }
    video, iframe { width: 100%; height: 100%; object-fit: contain; border: none; }
    .error-message { text-align: center; padding: 40px; }
    .category-title { font-weight: bold; font-size: 1.1em; padding: 10px; color: #4ecca3; border-bottom: 2px solid #4ecca3; margin: 10px 0; }
    .channel-item { padding: 10px; margin: 5px 0; cursor: pointer; border-radius: 8px; transition: all 0.2s; font-size: 0.95em; display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.1); }
    .channel-item.green { background: rgba(40, 167, 69, 0.8); }
    .channel-item.red { background: rgba(220, 53, 69, 0.8); }
    .channel-item.orange { background: rgba(253, 126, 20, 0.8); }
    .channel-item.cyan { background: rgba(23, 162, 184, 0.8); }
    .channel-item.purple { background: rgba(111, 66, 193, 0.8); }
    .channel-item.blue { background: rgba(0, 123, 255, 0.8); }
    .channel-item.pink { background: rgba(232, 62, 140, 0.8); }
    .channel-item.grey { background: rgba(108, 117, 125, 0.8); }
    .channel-item.yellow { background: rgba(255, 193, 7, 0.8); }
    .channel-item.maroon { background: rgba(128, 0, 0, 0.8); }
    .channel-item.brown { background: rgba(139, 69, 19, 0.8); }
    .channel-item.magenta { background: rgba(255, 0, 255, 0.8); }
    .channel-item.beige { background: rgba(245, 245, 220, 0.8); color: #333; }
    .channel-item:hover { opacity: 0.8; transform: translateX(5px); }
    .channel-item.active { box-shadow: 0 0 15px rgba(78, 204, 163, 0.8); font-weight: bold; }
    .favorite-btn { background: none; border: none; color: #ffd700; cursor: pointer; font-size: 1.2em; padding: 0; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
    ::-webkit-scrollbar-thumb { background: #4ecca3; border-radius: 4px; }
    .close-btn { display: none; position: fixed; top: 20px; right: 20px; z-index: 1001; background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-size: 1.2em; cursor: pointer; }
    @media (max-width: 768px) { .close-btn { display: block; } }
  </style>
</head>
<body>
  <div class="header">
    <h1>XOM TV</h1>
    <p>Alla iranska TV-kanaler ‚Äì Telewebion √∂ppnas i ny flik (fungerar garanterat)</p>
  </div>

  <div class="nav-buttons">
    <button class="nav-btn active" onclick="showAllChannels()">Alla kanaler</button>
    <button class="nav-btn" onclick="filterCategory('national')">1. Nationella</button>
    <button class="nav-btn" onclick="filterCategory('regional')">2. Regionala</button>
    <button class="nav-btn" onclick="filterCategory('kurdish')">3. Kurdiska</button>
    <button class="nav-btn" id="karwan-btn" onclick="toggleKarwanDropdown(event)">4. Karwan TV</button>
    <div class="dropdown-menu" id="karwan-dropdown">
      <div class="dropdown-item" onclick="filterKarwanCategory('all')">Alla Karwan kanaler</div>
      <div class="dropdown-item" onclick="filterKarwanCategory('blue')">Kids</div>
      <div class="dropdown-item" onclick="filterKarwanCategory('purple')">Movie</div>
      <div class="dropdown-item" onclick="filterKarwanCategory('pink')">Dubbad</div>
      <div class="dropdown-item" onclick="filterKarwanCategory('grey')">Blandad</div>
      <div class="dropdown-item" onclick="filterKarwanCategory('yellow')">Music</div>
      <div class="dropdown-item" onclick="filterKarwanCategory('maroon')">Dokument√§r</div>
      <div class="dropdown-item" onclick="filterKarwanCategory('green')">Dini</div>
      <div class="dropdown-item" onclick="filterKarwanCategory('brown')">Kultur</div>
      <div class="dropdown-item" onclick="filterKarwanCategory('magenta')">Srodi Dini</div>
      <div class="dropdown-item" onclick="filterKarwanCategory('beige')">Nyhet</div>
    </div>
    <button class="nav-btn" onclick="filterCategory('websites')">5. Webbplatser</button>
  </div>

  <div class="server-info">
    K√∂r via lokal server ‚Üí python -m http.server
  </div>

  <div class="container">
    <aside class="channel-list" id="channel-list">
      <button class="close-btn" onclick="toggleChannelList()">‚úï St√§ng</button>
      <div id="channels-container"></div>
    </aside>

    <main class="video-container">
      <div class="video-header">
        <div>
          <div class="video-title" id="current-channel">TV1</div>
          <div class="ua-selector">
            üì± UA: 
            <select id="ua-select" onchange="reloadStream()">
              <option value="">Auto</option>
              <option value="Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X)">iPhone</option>
              <option value="Mozilla/5.0 (iPad; CPU OS 14_0 like Mac OS X)">iPad</option>
              <option value="Mozilla/5.0 (Linux; Android 10)">Android</option>
            </select>
          </div>
        </div>
        <div class="video-controls">
          <button class="btn" onclick="toggleChannelList()">üì∫ Kanaler</button>
          <button class="btn" onclick="togglePiP()">üì∫ PiP</button>
          <button class="btn" onclick="toggleFullscreen()">‚õ∂ Fullsk√§rm</button>
          <button class="btn" onclick="reloadStream()">‚Üª Ladda om</button>
        </div>
      </div>

      <div class="video-wrapper" id="video-wrapper">
        <video id="video-player" controls></video>
      </div>
    </main>
  </div>

  <script>
    // Uppdaterade kanaler ‚Äì alla nationella & regionala √§r externa (√∂ppnas i ny flik)
    const channels = {
      national: [
        { name: 'TV1', url: 'https://www.telewebion.com/live/tv1', method: 'external', color: 'orange' },
        { name: 'TV2', url: 'https://www.telewebion.com/live/tv2', method: 'external', color: 'orange' },
        { name: 'TV3', url: 'https://www.telewebion.com/live/tv3', method: 'external', color: 'orange' },
        { name: 'TV4', url: 'https://www.telewebion.com/live/tv4', method: 'external', color: 'orange' },
        { name: 'Tehran', url: 'https://www.telewebion.com/live/tehran', method: 'external', color: 'orange' },
        { name: 'NASIM', url: 'https://www.telewebion.com/live/nasim', method: 'external', color: 'orange' },
        { name: 'VARZESH (Sport)', url: 'https://www.telewebion.com/live/varzesh', method: 'external', color: 'orange' },
        { name: 'IRINN / KHABAR', url: 'https://www.telewebion.com/live/irinn', method: 'external', color: 'orange' },
        { name: 'IFILM', url: 'https://www.telewebion.com/live/ifilm', method: 'external', color: 'orange' },
        { name: 'OMID', url: 'https://www.telewebion.com/live/omid', method: 'external', color: 'orange' },
        { name: 'NAMAYESH', url: 'https://www.telewebion.com/live/namayesh', method: 'external', color: 'orange' },
        { name: 'MOSTANAD', url: 'https://www.telewebion.com/live/mostanad', method: 'external', color: 'orange' },
        { name: 'TAMASHA', url: 'https://www.telewebion.com/live/tamasha', method: 'external', color: 'orange' },
        { name: 'AMOOZESH', url: 'https://www.telewebion.com/live/amouzesh', method: 'external', color: 'orange' },
        { name: 'SALAMAT', url: 'https://www.telewebion.com/live/salamat', method: 'external', color: 'orange' },
        { name: 'QURAN TV', url: 'https://www.telewebion.com/live/quran', method: 'external', color: 'orange' },
        { name: 'POOYA', url: 'https://www.telewebion.com/live/pooya', method: 'external', color: 'orange' },
        { name: 'JAVANEH', url: 'https://www.telewebion.com/live/javaneh', method: 'external', color: 'orange' },
        { name: 'SEPEHR', url: 'https://www.telewebion.com/live/sepehr', method: 'external', color: 'orange' },
        { name: 'FARATAR', url: 'https://www.telewebion.com/live/faratar', method: 'external', color: 'orange' },
        { name: 'NAVA', url: 'https://www.telewebion.com/live/nava', method: 'external', color: 'orange' },
        { name: 'NAMA', url: 'https://www.telewebion.com/live/nama', method: 'external', color: 'orange' },
        { name: 'ROYA', url: 'https://www.telewebion.com/live/roya', method: 'external', color: 'orange' },
        { name: 'ARA', url: 'https://www.telewebion.com/live/ara', method: 'external', color: 'orange' },
        { name: 'IRANEMAN', url: 'https://www.telewebion.com/live/iraneman', method: 'external', color: 'orange' },
        { name: 'GOLKHANE', url: 'https://www.telewebion.com/live/golkhane', method: 'external', color: 'orange' },
        { name: 'NEGARESTAN', url: 'https://www.telewebion.com/live/negarestan', method: 'external', color: 'orange' },
        { name: 'KAROON', url: 'https://www.telewebion.com/live/karoon', method: 'external', color: 'orange' },
        { name: 'PARSEH', url: 'https://www.telewebion.com/live/parseh', method: 'external', color: 'orange' },
        { name: 'NESFEJAHAN', url: 'https://www.telewebion.com/live/nesfejahan', method: 'external', color: 'orange' },
        { name: 'SARBEDARAN', url: 'https://www.telewebion.com/live/sarbedaran', method: 'external', color: 'orange' }
      ],
      regional: [
        { name: 'Mahabad', url: 'https://www.telewebion.com/live/mahabad', method: 'external', color: 'orange' },
        { name: 'Kordestan', url: 'https://www.telewebion.com/live/kordestan', method: 'external', color: 'orange' },
        { name: 'Kermanshah', url: 'https://www.telewebion.com/live/zagros', method: 'external', color: 'orange' },
        { name: 'Ilam', url: 'https://www.telewebion.com/live/ilam', method: 'external', color: 'orange' },
        { name: 'Bushehr', url: 'https://www.telewebion.com/live/bushehr', method: 'external', color: 'orange' },
        { name: 'Abadan', url: 'https://www.telewebion.com/live/abadan', method: 'external', color: 'orange' },
        { name: 'Bandar Abbas', url: 'https://www.telewebion.com/live/khalijefars', method: 'external', color: 'orange' },
        { name: 'Ahvaz', url: 'https://www.telewebion.com/live/khoozestan', method: 'external', color: 'orange' },
        { name: 'Kish', url: 'https://www.telewebion.com/live/kish', method: 'external', color: 'orange' },
        { name: 'Zahedan', url: 'https://www.telewebion.com/live/hamoon', method: 'external', color: 'orange' },
        { name: 'Alborz', url: 'https://www.telewebion.com/live/alborz', method: 'external', color: 'orange' },
        { name: 'Arak', url: 'https://www.telewebion.com/live/aftab', method: 'external', color: 'orange' },
        { name: 'Semnan', url: 'https://www.telewebion.com/live/semnan', method: 'external', color: 'orange' },
        { name: 'Qom', url: 'https://www.telewebion.com/live/noor', method: 'external', color: 'orange' },
        { name: 'Qazvin', url: 'https://www.telewebion.com/live/qazvin', method: 'external', color: 'orange' },
        { name: 'Chaharmahal', url: 'https://www.telewebion.com/live/jahanbin', method: 'external', color: 'orange' },
        { name: 'Hamadan', url: 'https://www.telewebion.com/live/sina', method: 'external', color: 'orange' },
        { name: 'Lorestan', url: 'https://www.telewebion.com/live/aflak', method: 'external', color: 'orange' },
        { name: 'Kerman', url: 'https://www.telewebion.com/live/kerman', method: 'external', color: 'orange' },
        { name: 'Isfahan', url: 'https://www.telewebion.com/live/esfahan', method: 'external', color: 'orange' },
        { name: 'Fars', url: 'https://www.telewebion.com/live/fars', method: 'external', color: 'orange' },
        { name: 'Yazd', url: 'https://www.telewebion.com/live/taban', method: 'external', color: 'orange' },
        { name: 'Yasuj', url: 'https://www.telewebion.com/live/dena', method: 'external', color: 'orange' },
        { name: 'Khorasan Jonubi', url: 'https://www.telewebion.com/live/khavaran', method: 'external', color: 'orange' },
        { name: 'Khorasan Shomali', url: 'https://www.telewebion.com/live/atrak', method: 'external', color: 'orange' },
        { name: 'Khorasan Razavi', url: 'https://www.telewebion.com/live/khorasanrazavi', method: 'external', color: 'orange' },
        { name: 'Golestan', url: 'https://www.telewebion.com/live/sabz', method: 'external', color: 'orange' },
        { name: 'Mazandaran', url: 'https://www.telewebion.com/live/tabarestan', method: 'external', color: 'orange' },
        { name: 'Gilan', url: 'https://www.telewebion.com/live/baran', method: 'external', color: 'orange' },
        { name: 'Ardabil', url: 'https://www.telewebion.com/live/sabalan', method: 'external', color: 'orange' },
        { name: 'Tabriz', url: 'https://www.telewebion.com/live/sahand', method: 'external', color: 'orange' },
        { name: 'Urmia', url: 'https://www.telewebion.com/live/azarbayjangharbi', method: 'external', color: 'orange' },
        { name: 'Zanjan', url: 'https://www.telewebion.com/live/eshragh', method: 'external', color: 'orange' }
      ],
      kurdish: [ /* of√∂r√§ndrad ‚Äì fungerande HLS */ 
        { name: 'Zagros (HLS)', url: 'https://5a3ed7a72ed4b.streamlock.net/zagrostv/SMIL:myStream.smil/playlist.m3u8', color: 'green' },
        { name: 'Kanal8 (HLS)', url: 'https://live.channel8.com/Channel8-Kurdish/index.fmp4.m3u8', color: 'green' },
        { name: 'Rudaw (HLS)', url: 'https://svs.itworkscdn.net/rudawlive/rudawlive.smil/playlist.m3u8', color: 'green' },
        { name: 'Kurdsat News (HLS)', url: 'https://hlspackager.akamaized.net/live/DB/KURDSAT_NEWS/HLS/KURDSAT_NEWS.m3u8', color: 'green' },
        { name: 'Sterk (HLS)', url: 'https://5dab1db4b25fe.streamlock.net/sterk/sterktv/chunklist_w1084077249.m3u8', color: 'green' },
        { name: 'NRT News (HLS)', url: 'https://media.streambrothers.com:1936/8226/8226/playlist.m3u8', color: 'green' },
        { name: '4 Kurd (HLS)', url: 'https://4kuhls.persiana.live/hls/stream.m3u8', color: 'green' },
        { name: 'Med Music (HLS)', url: 'https://zindu.tv/intern-play.php?url=http://54.36.110.140/live3/live3.m3u8', color: 'green' },
        { name: 'Aryen (HLS)', url: 'https://stream.aryen.tv/live/tv/chunklist_w189856026.m3u8', color: 'green' },
        { name: 'Waar (HLS)', url: 'https://live.kwikmotion.com/waarmedialive/waarmedia.smil/waarmediapublish/waarmedia_source/chunks.m3u8', color: 'green' },
        { name: 'Rojava (HLS)', url: 'https://hlspackager.akamaized.net/live/DB/ROJAVA_HD/HLS/ROJAVA_HD.m3u8', color: 'green' },
        { name: 'Kurdsat HD (HLS)', url: 'https://hlspackager.akamaized.net/live/DB/KURDSAT_HD/HLS/KURDSAT_HD.m3u8', color: 'green' },
        { name: 'Kurdistan TV (HLS)', url: 'https://5a3ed7a72ed4b.streamlock.net/live/SMIL:myStream.smil/playlist.m3u8', color: 'green' },
        { name: 'PDKI (HLS)', url: 'https://northtelecom.live/KURD.m3u8', color: 'green' },
        { name: 'Komala (HLS)', url: 'https://live.tvkomala.com/live/komala/playlist.m3u8', color: 'green' },
        { name: 'GK (HLS)', url: 'https://live.host247.net/gk/gksat/chunklist_w624411416.m3u8', color: 'green' },
        { name: 'IRIB Kurdistan (HLS)', url: 'https://live.irib.ir/kordestan/playlist.m3u8', color: 'green' },
        { name: 'Ava TV (Web)', url: 'https://www.ava.news/livewatch', method: 'external', color: 'orange' },
        { name: 'Sahar TV (Web)', url: 'https://kurdish.sahartv.ir/live', method: 'external', color: 'orange' },
        { name: 'UTV Hawler (Web)', url: 'https://utvhawler.net/index.htm', method: 'external', color: 'orange' },
        { name: 'Baxche (HLS)', url: 'https://5dcabf026b188.streamlock.net/afarinTV/livestream/playlist.m3u8', color: 'green' },
        { name: 'Afarin Kids (HLS)', url: 'https://65f16f0fdfc51.streamlock.net/afarinTV/livestream/playlist.m3u8', color: 'green' },
        { name: 'Zarok Kurmanci (HLS)', url: 'https://zindikurmanci.zaroktv.com.tr/hls/0/stream.m3u8', color: 'green' },
        { name: 'Zarok Sorani (HLS)', url: 'https://zindisorani.zaroktv.com.tr/hls/stream.m3u8', color: 'green' },
        { name: 'Payam TV (HLS)', url: 'https://media2.streambrothers.com:1936/8218/8218/chunklist_w1239498607.m3u8', color: 'green' },
        { name: 'TRT Kurd√Æ (HLS)', url: 'https://tv-trtkurdi.medya.trt.com.tr/master_1440.m3u8', color: 'green' }
      ],
      karwan: [ /* of√∂r√§ndrad ‚Äì externa */ 
        // Kids (blue)
        { name: 'Kidco TV', url: 'https://karwan.tv/kidco-tv', method: 'external', color: 'blue', subgroup: 'blue' },
        { name: 'MMN Kids', url: 'https://karwan.tv/mmn-kids', method: 'external', color: 'blue', subgroup: 'blue' },
        { name: 'NRT 3 Kids', url: 'https://karwan.tv/nrt-3-kids', method: 'external', color: 'blue', subgroup: 'blue' },
        { name: 'Kurdmax Pepule', url: 'https://karwan.tv/kurdmax-pepule', method: 'external', color: 'blue', subgroup: 'blue' },
        { name: 'Jojo Mama', url: 'https://karwan.tv/jojo-mama', method: 'external', color: 'blue', subgroup: 'blue' },
        { name: 'Astera Baby', url: 'https://karwan.tv/astera-baby', method: 'external', color: 'blue', subgroup: 'blue' },
        // Movie (purple)
        { name: 'MMN Movies', url: 'https://karwan.tv/mmn-movies', method: 'external', color: 'purple', subgroup: 'purple' },
        { name: 'Soran Entertainment TV', url: 'https://karwan.tv/soran-entertainment-tv', method: 'external', color: 'purple', subgroup: 'purple' },
        { name: 'Bnar Movies', url: 'https://karwan.tv/bnar-movies', method: 'external', color: 'purple', subgroup: 'purple' },
        { name: 'Bnar TV', url: 'https://karwan.tv/bnar-tv', method: 'external', color: 'purple', subgroup: 'purple' },
        { name: 'Befrin TV', url: 'https://karwan.tv/befrin-tv', method: 'external', color: 'purple', subgroup: 'purple' },
        { name: 'Jamawar TV', url: 'https://karwan.tv/jamawar-tv', method: 'external', color: 'purple', subgroup: 'purple' },
        { name: 'Barin Movies', url: 'https://karwan.tv/barin-movies', method: 'external', color: 'purple', subgroup: 'purple' },
        { name: 'Astera Movies', url: 'https://karwan.tv/astera-movies', method: 'external', color: 'purple', subgroup: 'purple' },
        { name: 'Derwaze TV', url: 'https://karwan.tv/derwaze-tv', method: 'external', color: 'purple', subgroup: 'purple' },
        { name: 'Bnar Action', url: 'https://karwan.tv/bnar-action', method: 'external', color: 'purple', subgroup: 'purple' },
        // Dubbad (pink)
        { name: 'MMN Drama', url: 'https://karwan.tv/mmn-drama', method: 'external', color: 'pink', subgroup: 'pink' },
        { name: 'MMN Show', url: 'https://karwan.tv/mmn-show', method: 'external', color: 'pink', subgroup: 'pink' },
        { name: 'Astera Show', url: 'https://karwan.tv/astera-show', method: 'external', color: 'pink', subgroup: 'pink' },
        { name: 'Infinity TV', url: 'https://karwan.tv/infinity-tv', method: 'external', color: 'pink', subgroup: 'pink' },
        { name: 'Astera Family', url: 'https://karwan.tv/astera-family', method: 'external', color: 'pink', subgroup: 'pink' },
        { name: 'Barin Family', url: 'https://karwan.tv/barin-family', method: 'external', color: 'pink', subgroup: 'pink' },
        { name: 'Srusht TV', url: 'https://karwan.tv/srusht-tv', method: 'external', color: 'pink', subgroup: 'pink' },
        { name: 'Avar TV', url: 'https://karwan.tv/avar-tv', method: 'external', color: 'pink', subgroup: 'pink' },
        { name: 'Halabja TV', url: 'https://karwan.tv/halabja-tv', method: 'external', color: 'pink', subgroup: 'pink' },
        { name: 'Rozh TV', url: 'https://karwan.tv/rozh-tv', method: 'external', color: 'pink', subgroup: 'pink' },
        { name: 'Speda Drama', url: 'https://karwan.tv/speda-drama', method: 'external', color: 'pink', subgroup: 'pink' },
        { name: 'Delal TV', url: 'https://karwan.tv/delal-tv', method: 'external', color: 'pink', subgroup: 'pink' },
        { name: 'Kurdmax TV', url: 'https://karwan.tv/kurdmax-tv', method: 'external', color: 'pink', subgroup: 'pink' },
        { name: 'Zaxo TV', url: 'https://karwan.tv/zaxo-tv', method: 'external', color: 'pink', subgroup: 'pink' },
        { name: 'Kurdmax Show TV', url: 'https://karwan.tv/kurdmax-show-tv', method: 'external', color: 'pink', subgroup: 'pink' },
        { name: 'Mix TV', url: 'https://karwan.tv/mix-tv', method: 'external', color: 'pink', subgroup: 'pink' },
        // Blandad (grey)
        { name: 'Karwan Duhok TV', url: 'https://karwan.tv/duhok-tv', method: 'external', color: 'grey', subgroup: 'grey' },
        { name: 'Cihan TV', url: 'https://karwan.tv/cihan-tv', method: 'external', color: 'grey', subgroup: 'grey' },
        { name: 'Khak TV', url: 'https://karwan.tv/khak-tv', method: 'external', color: 'grey', subgroup: 'grey' },
        { name: 'Zed TV Plus', url: 'https://karwan.tv/zed-tv-plus', method: 'external', color: 'grey', subgroup: 'grey' },
        { name: 'Karwan Slemani TV', url: 'https://karwan.tv/slemani-tv', method: 'external', color: 'grey', subgroup: 'grey' },
        // Music (yellow)
        { name: 'Sima TV', url: 'https://karwan.tv/sima-tv', method: 'external', color: 'yellow', subgroup: 'yellow' },
        { name: 'Shna TV', url: 'https://karwan.tv/shna-tv', method: 'external', color: 'yellow', subgroup: 'yellow' },
        { name: 'Kurd 7', url: 'https://karwan.tv/kurd-7', method: 'external', color: 'yellow', subgroup: 'yellow' },
        { name: 'Kurdmax Music', url: 'https://karwan.tv/kurdmax-music', method: 'external', color: 'yellow', subgroup: 'yellow' },
        { name: 'MMN Clip', url: 'https://karwan.tv/mmn-clip', method: 'external', color: 'yellow', subgroup: 'yellow' },
        { name: 'Astera Culture', url: 'https://karwan.tv/astera-culture', method: 'external', color: 'yellow', subgroup: 'yellow' },
        { name: 'Derin TV', url: 'https://karwan.tv/derin-tv', method: 'external', color: 'yellow', subgroup: 'yellow' },
        { name: 'Reng TV', url: 'https://karwan.tv/reng-tv', method: 'external', color: 'yellow', subgroup: 'yellow' },
        { name: 'Euro Kurd TV', url: 'https://karwan.tv/euro-kurd-tv', method: 'external', color: 'yellow', subgroup: 'yellow' },
        { name: 'Kurdana TV', url: 'https://karwan.tv/kurdana-tv', method: 'external', color: 'yellow', subgroup: 'yellow' },
        { name: 'Azadi TV', url: 'https://karwan.tv/azadi-tv', method: 'external', color: 'yellow', subgroup: 'yellow' },
        { name: 'Kanal 21', url: 'https://karwan.tv/kanali-21', method: 'external', color: 'yellow', subgroup: 'yellow' },
        // Dokument√§r (maroon)
        { name: 'MMN Documentary', url: 'https://karwan.tv/mmn-documentary', method: 'external', color: 'maroon', subgroup: 'maroon' },
        { name: 'Astera Documentary', url: 'https://karwan.tv/astera-documentary', method: 'external', color: 'maroon', subgroup: 'maroon' },
        { name: 'Reng Documentary', url: 'https://karwan.tv/reng-documentary', method: 'external', color: 'maroon', subgroup: 'maroon' },
        { name: 'Zed TV', url: 'https://karwan.tv/zed-tv', method: 'external', color: 'maroon', subgroup: 'maroon' },
        // Dini (green)
        { name: 'NRT 4', url: 'https://karwan.tv/nrt-4', method: 'external', color: 'green', subgroup: 'green' },
        { name: 'Mihrab TV', url: 'https://karwan.tv/mihrab-tv', method: 'external', color: 'green', subgroup: 'green' },
        { name: 'UTV Duhok', url: 'https://karwan.tv/utv-duhok', method: 'external', color: 'green', subgroup: 'green' },
        { name: 'UTV Hawler', url: 'https://karwan.tv/utv-hawler', method: 'external', color: 'green', subgroup: 'green' },
        { name: 'Shar TV', url: 'https://karwan.tv/shar-tv', method: 'external', color: 'green', subgroup: 'green' },
        { name: 'Farmoda TV', url: 'https://karwan.tv/farmoda-tv', method: 'external', color: 'green', subgroup: 'green' },
        { name: 'Ranya TV', url: 'https://karwan.tv/ranya-tv', method: 'external', color: 'green', subgroup: 'green' },
        { name: 'Aro Family', url: 'https://karwan.tv/aro-family', method: 'external', color: 'green', subgroup: 'green' },
        // Kultur (brown)
        { name: 'Dever TV', url: 'https://karwan.tv/dever-tv', method: 'external', color: 'brown', subgroup: 'brown' },
        { name: 'Rasan TV', url: 'https://karwan.tv/rasan-tv', method: 'external', color: 'brown', subgroup: 'brown' },
        // Srodi Dini (magenta)
        { name: 'Dimen TV', url: 'https://karwan.tv/dimen-tv', method: 'external', color: 'magenta', subgroup: 'magenta' },
        { name: 'Bangxwazen Badinan TV', url: 'https://karwan.tv/bangxwazen-badinan-tv', method: 'external', color: 'magenta', subgroup: 'magenta' },
        { name: 'Esra TV', url: 'https://karwan.tv/esra-tv', method: 'external', color: 'magenta', subgroup: 'magenta' },
        // Nyhet (beige)
        { name: 'Kurd Channel', url: 'https://karwan.tv/kurd-channel', method: 'external', color: 'beige', subgroup: 'beige' },
        { name: 'Cira TV', url: 'https://karwan.tv/cira-tv', method: 'external', color: 'beige', subgroup: 'beige' },
        { name: 'Karwan Nalia TV', url: 'https://karwan.tv/nalia-tv', method: 'external', color: 'beige', subgroup: 'beige' },
        { name: 'Rojhelat TV', url: 'https://karwan.tv/rojhelat-tv', method: 'external', color: 'beige', subgroup: 'beige' },
        { name: 'Speda TV', url: 'https://karwan.tv/speda-tv', method: 'external', color: 'beige', subgroup: 'beige' },
        { name: 'Kirkuk TV', url: 'https://karwan.tv/kirkuk-tv', method: 'external', color: 'beige', subgroup: 'beige' },
        { name: 'Ava TV', url: 'https://karwan.tv/ava-tv', method: 'external', color: 'beige', subgroup: 'beige' }
      ],
      websites: [ /* of√∂r√§ndrad */ 
        { name: 'IMVBox', url: 'https://www.imvbox.com/en', method: 'external', color: 'orange' },
        { name: 'Persianity', url: 'https://persianity.com', method: 'external', color: 'orange' },
        { name: 'Parsa TV', url: 'https://parsatv.com', method: 'external', color: 'orange' },
        { name: 'MDB Max', url: 'https://mdbmax.com/', method: 'external', color: 'orange' },
        { name: 'FarsiPlex', url: 'https://farsiplex.com', method: 'external', color: 'orange' },
        { name: 'Flnd Buzz', url: 'https://flnd.buzz/', method: 'external', color: 'orange' },
        { name: 'Farsiland Movies', url: 'https://farsiland.com/movies', method: 'external', color: 'orange' },
        { name: 'Persian Hive', url: 'https://persianhive.com', method: 'external', color: 'orange' },
        { name: 'Namakade', url: 'https://namakade.com', method: 'external', color: 'orange' },
        { name: 'Telewebion', url: 'https://telewebion.com/', method: 'external', color: 'orange' },
        { name: 'Sepehr TV', url: 'https://beta.sepehrtv.ir/', method: 'external', color: 'orange' },
        { name: 'Sassan TV', url: 'https://sassantv.com/', method: 'external', color: 'orange' },
        { name: 'Giniko TV', url: 'https://giniko.com/watch.php?id=iran', method: 'external', color: 'orange' }
      ]
    };

    // --- JavaScript (samma som tidigare, of√∂r√§ndrad) ---
    let hls;
    let currentChannel = { name: 'TV1', url: 'https://www.telewebion.com/live/tv1', method: 'external' };
    let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
    let currentFilter = null;
    let currentKarwanSubgroup = 'all';

    function renderChannels(filter = null, karwanSubgroup = 'all') {
      console.log('renderChannels called with:', filter, karwanSubgroup);
      const container = document.getElementById('channels-container');
      let html = '';
      currentFilter = filter;
      currentKarwanSubgroup = karwanSubgroup;

      container.innerHTML = '';

      if (filter === 'karwan') {
        const subgroupNames = {
          'all': 'Alla Karwan kanaler',
          'blue': 'Kids',
          'purple': 'Movie',
          'pink': 'Dubbad',
          'grey': 'Blandad',
          'yellow': 'Music',
          'maroon': 'Dokument√§r',
          'green': 'Dini',
          'brown': 'Kultur',
          'magenta': 'Srodi Dini',
          'beige': 'Nyhet'
        };

        let filteredChannels;
        if (karwanSubgroup === 'all') {
          filteredChannels = channels.karwan;
        } else {
          filteredChannels = channels.karwan.filter(ch => ch.subgroup === karwanSubgroup);
        }

        if (filteredChannels.length === 0) {
          html += `<div class="category-title">Inga kanaler hittades f√∂r denna kategori</div>`;
        } else {
          html += `<div class="category-title">Karwan TV - ${subgroupNames[karwanSubgroup]} (${filteredChannels.length})</div>`;
          
          filteredChannels.forEach(ch => {
            const isFav = favorites.some(f => f.name === ch.name);
            html += `
              <div class="channel-item ${ch.color}" onclick="loadChannel('${ch.url.replace(/'/g, "\\'")}', '${ch.name.replace(/'/g, "\\'")}', '${ch.method || 'hls'}')">
                <span>${ch.name}</span>
                <button class="favorite-btn" onclick="event.stopPropagation(); toggleFavorite('${ch.name.replace(/'/g, "\\'")}', '${ch.url.replace(/'/g, "\\'")}', '${ch.method || 'hls'}')">
                  ${isFav ? '‚≠ê' : '‚òÜ'}
                </button>
              </div>
            `;
          });
        }
      } else if (filter) {
        const categoryNames = {
          national: 'Nationella Kanaler',
          regional: 'Regionala Kanaler',
          kurdish: 'Kurdiska Kanaler',
          websites: 'Webbplatser'
        };

        if (channels[filter] && channels[filter].length > 0) {
          html += `<div class="category-title">${categoryNames[filter]}</div>`;
          
          channels[filter].forEach(ch => {
            const isFav = favorites.some(f => f.name === ch.name);
            html += `
              <div class="channel-item ${ch.color}" onclick="loadChannel('${ch.url.replace(/'/g, "\\'")}', '${ch.name.replace(/'/g, "\\'")}', '${ch.method || 'hls'}')">
                <span>${ch.name}</span>
                <button class="favorite-btn" onclick="event.stopPropagation(); toggleFavorite('${ch.name.replace(/'/g, "\\'")}', '${ch.url.replace(/'/g, "\\'")}', '${ch.method || 'hls'}')">
                  ${isFav ? '‚≠ê' : '‚òÜ'}
                </button>
              </div>
            `;
          });
        }
      } else {
        Object.keys(channels).forEach(category => {
          if (category === 'karwan' && currentKarwanSubgroup !== 'all') return;
          
          const categoryNames = {
            national: 'Nationella Kanaler',
            regional: 'Regionala Kanaler',
            kurdish: 'Kurdiska Kanaler',
            karwan: 'Karwan TV',
            websites: 'Webbplatser'
          };

          const categoryChannels = category === 'karwan' && currentKarwanSubgroup !== 'all' 
            ? channels[category].filter(ch => ch.subgroup === currentKarwanSubgroup)
            : channels[category];

          if (categoryChannels.length > 0) {
            html += `<div class="category-title">${categoryNames[category]}</div>`;
            
            categoryChannels.forEach(ch => {
              const isFav = favorites.some(f => f.name === ch.name);
              html += `
                <div class="channel-item ${ch.color}" onclick="loadChannel('${ch.url.replace(/'/g, "\\'")}', '${ch.name.replace(/'/g, "\\'")}', '${ch.method || 'hls'}')">
                  <span>${ch.name}</span>
                  <button class="favorite-btn" onclick="event.stopPropagation(); toggleFavorite('${ch.name.replace(/'/g, "\\'")}', '${ch.url.replace(/'/g, "\\'")}', '${ch.method || 'hls'}')">
                    ${isFav ? '‚≠ê' : '‚òÜ'}
                  </button>
                </div>
              `;
            });
          }
        });
      }

      container.innerHTML = html;
      updateActiveChannel();
      updateDropdownActiveState(karwanSubgroup);
    }

    function updateActiveChannel() {
      document.querySelectorAll('.channel-item').forEach(item => {
        item.classList.remove('active');
        
        const channelName = item.querySelector('span').textContent;
        if (channelName === currentChannel.name) {
          item.classList.add('active');
        }
      });
    }

    function updateDropdownActiveState(subgroup) {
      document.querySelectorAll('.dropdown-item').forEach(item => {
        item.classList.remove('active');
        
        if (subgroup === 'all' && item.textContent === 'Alla Karwan kanaler') {
          item.classList.add('active');
        } else if (subgroup === 'blue' && item.textContent === 'Kids') {
          item.classList.add('active');
        } else if (subgroup === 'purple' && item.textContent === 'Movie') {
          item.classList.add('active');
        } else if (subgroup === 'pink' && item.textContent === 'Dubbad') {
          item.classList.add('active');
        } else if (subgroup === 'grey' && item.textContent === 'Blandad') {
          item.classList.add('active');
        } else if (subgroup === 'yellow' && item.textContent === 'Music') {
          item.classList.add('active');
        } else if (subgroup === 'maroon' && item.textContent === 'Dokument√§r') {
          item.classList.add('active');
        } else if (subgroup === 'green' && item.textContent === 'Dini') {
          item.classList.add('active');
        } else if (subgroup === 'brown' && item.textContent === 'Kultur') {
          item.classList.add('active');
        } else if (subgroup === 'magenta' && item.textContent === 'Srodi Dini') {
          item.classList.add('active');
        } else if (subgroup === 'beige' && item.textContent === 'Nyhet') {
          item.classList.add('active');
        }
      });
    }

    function toggleFavorite(name, url, method) {
      const index = favorites.findIndex(f => f.name === name);
      if (index > -1) {
        favorites.splice(index, 1);
      } else {
        favorites.push({ name, url, method });
      }
      localStorage.setItem('favorites', JSON.stringify(favorites));
      renderChannels(currentFilter, currentKarwanSubgroup);
    }

    function showAllChannels() {
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector('.nav-btn:first-child').classList.add('active');
      closeKarwanDropdown();
      renderChannels(null, 'all');
    }

    function filterCategory(category) {
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      closeKarwanDropdown();
      renderChannels(category, 'all');
    }

    function filterKarwanCategory(subgroup) {
      console.log('filterKarwanCategory called with:', subgroup);
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById('karwan-btn').classList.add('active');
      closeKarwanDropdown();
      renderChannels('karwan', subgroup);
    }

    function toggleKarwanDropdown(e) {
      if (e) e.stopPropagation();
      const dropdown = document.getElementById('karwan-dropdown');
      const isOpen = dropdown.classList.contains('show');
      
      closeKarwanDropdown();
      
      if (!isOpen) {
        dropdown.classList.add('show');
        updateDropdownActiveState(currentKarwanSubgroup);
        setTimeout(() => {
          document.addEventListener('click', closeKarwanDropdownOnClick);
        }, 10);
      }
    }

    function closeKarwanDropdown() {
      const dropdown = document.getElementById('karwan-dropdown');
      dropdown.classList.remove('show');
      document.removeEventListener('click', closeKarwanDropdownOnClick);
    }

    function closeKarwanDropdownOnClick(event) {
      const dropdown = document.getElementById('karwan-dropdown');
      const karwanBtn = document.getElementById('karwan-btn');
      
      if (!dropdown.contains(event.target) && !karwanBtn.contains(event.target)) {
        closeKarwanDropdown();
      }
    }

    function toggleChannelList() {
      const list = document.getElementById('channel-list');
      list.classList.toggle('show');
    }

    function loadChannel(url, name, method = 'hls') {
      if (window.innerWidth <= 768) {
        document.getElementById('channel-list').classList.remove('show');
      }
      
      currentChannel = { name, url, method };
      document.getElementById('current-channel').textContent = name;
      
      const wrapper = document.getElementById('video-wrapper');
      
      if (hls) {
        hls.destroy();
        hls = null;
      }
      
      if (method === 'external') {
        window.open(url, '_blank');
        return;
      }
      
      if (method === 'iframe') {
        wrapper.innerHTML = `<iframe src="${url}" allowfullscreen allow="autoplay" style="width:100%;height:100%;border:none;"></iframe>`;
        updateActiveChannel();
        return;
      }

      wrapper.innerHTML = '<video id="video-player" controls crossorigin="anonymous"></video>';
      const video = document.getElementById('video-player');

      if (url.includes('.m3u8')) {
        if (Hls.isSupported()) {
          hls = new Hls({
            debug: false,
            enableWorker: true,
            lowLatencyMode: false,
            xhrSetup: function(xhr) {
              const ua = document.getElementById('ua-select').value;
              if (ua) xhr.setRequestHeader('User-Agent', ua);
            }
          });
          
          hls.on(Hls.Events.MANIFEST_PARSED, () => {
            video.play().catch(() => {});
          });
          
          hls.on(Hls.Events.ERROR, (event, data) => {
            if (data.fatal) {
              if (data.type === Hls.ErrorTypes.NETWORK_ERROR) {
                setTimeout(() => hls.startLoad(), 1000);
              } else if (data.type === Hls.ErrorTypes.MEDIA_ERROR) {
                hls.recoverMediaError();
              } else {
                showError();
              }
            }
          });
          
          hls.loadSource(url);
          hls.attachMedia(video);
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
          video.src = url;
          video.play().catch(() => {});
        } else {
          showError();
        }
      } else {
        video.src = url;
        video.play().catch(() => {});
      }

      updateActiveChannel();
    }

    function showError() {
      document.getElementById('video-wrapper').innerHTML = `
        <div class="error-message">
          <h3>‚ö†Ô∏è Kunde inte ladda stream</h3>
          <button class="btn" onclick="reloadStream()">F√∂rs√∂k igen</button>
        </div>
      `;
    }

    function reloadStream() {
      loadChannel(currentChannel.url, currentChannel.name, currentChannel.method);
    }

    function togglePiP() {
      const video = document.getElementById('video-player');
      if (video && document.pictureInPictureEnabled) {
        if (document.pictureInPictureElement) {
          document.exitPictureInPicture();
        } else {
          video.requestPictureInPicture().catch(() => {});
        }
      }
    }

    function toggleFullscreen() {
      const wrapper = document.getElementById('video-wrapper');
      if (!document.fullscreenElement) {
        wrapper.requestFullscreen().catch(() => {});
      } else {
        document.exitFullscreen();
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      renderChannels();
      loadChannel(currentChannel.url, currentChannel.name, currentChannel.method);
      document.querySelector('.nav-btn:first-child').classList.add('active');
    });
  </script>
</body>
</html>
