<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XOM TV - TEST</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background: #1e3c72; color: #fff; }
    .header { background: rgba(0,0,0,0.3); padding: 20px; text-align: center; }
    .header h1 { font-size: 2.5em; color: #4ecca3; }
    .container { display: flex; height: 90vh; padding: 20px; gap: 20px; }
    .channel-list { width: 300px; background: rgba(0,0,0,0.4); overflow-y: auto; border-radius: 10px; padding: 10px; }
    .video-container { flex: 1; background: #000; border-radius: 10px; overflow: hidden; display: flex; flex-direction: column; }
    .video-header { background: rgba(0,0,0,0.8); padding: 15px; }
    .video-title { font-size: 1.3em; color: #4ecca3; }
    .video-wrapper { flex: 1; position: relative; background: #000; }
    video, iframe { width: 100%; height: 100%; border: none; }
    .channel-item { padding: 12px; margin: 5px 0; cursor: pointer; border-radius: 5px; background: rgba(255,255,255,0.1); }
    .channel-item:hover { background: rgba(78,204,163,0.3); }
    .channel-item.active { background: rgba(78,204,163,0.5); font-weight: bold; }
    .error-msg { text-align: center; padding: 40px; }
    .proxy-bar { background: #333; padding: 10px; display: flex; gap: 10px; align-items: center; }
    .proxy-input { flex: 1; padding: 5px; background: #444; color: white; border: 1px solid #4ecca3; }
    .proxy-status { padding: 3px 10px; border-radius: 10px; }
    .proxy-status.on { background: green; }
    .proxy-status.off { background: gray; }
    .btn { background: #4ecca3; color: #1e3c72; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="header">
    <h1>XOM TV - TEST</h1>
    <p>Endast nationella kanaler</p>
  </div>

  <div class="proxy-bar">
    <input class="proxy-input" id="proxy-url" type="text" placeholder="Proxy URL (valfritt)" oninput="updateProxy()">
    <span class="proxy-status off" id="proxy-status">Av</span>
    <button class="btn" onclick="setPreset('cors-anywhere')">cors-anywhere</button>
    <button class="btn" onclick="setPreset('allorigins')">allorigins</button>
    <button class="btn" onclick="clearProxy()">Rensa</button>
  </div>

  <div class="container">
    <aside class="channel-list" id="channel-list">
      <div id="ch-container"></div>
    </aside>
    <main class="video-container">
      <div class="video-header">
        <div class="video-title" id="ch-title">V√§lj en kanal</div>
      </div>
      <div class="video-wrapper" id="vwrap">
        <div class="error-msg"><h3>üëà V√§lj en kanal</h3></div>
      </div>
    </main>
  </div>

<script>
  // ENDAST NATIONELLA KANALER
  const channels = [
    // TV1 EXTRA - Flera olika alternativ att testa
    { name: '01. TV1 (Parsatv)', url: 'https://parsatv.com/Shabake-1', method: 'iframe', color: 'green' },
    { name: '02. TV1 (Telewebion)', url: 'https://telewebion.ir/live/tv1', method: 'iframe', color: 'blue' },
    { name: '03. TV1 (Yozonline)', url: 'https://yozonline.ir/tv1/', method: 'iframe', color: 'purple' },
    { name: '04. TV1 (IMVBox)', url: 'https://www.imvbox.tv/en/iribtv1/live-channel/play', method: 'iframe', color: 'orange' },
    { name: '05. TV1 (HLS - beh√∂ver proxy)', url: 'https://ncdn.telewebion.ir/tv1/live/playlist.m3u8', method: 'hls', color: 'red' },
    
    // Andra nationella kanaler
    { name: '06. TV2', url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226176/2.m3u8', method: 'hls', color: 'green' },
    { name: '07. TV3', url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226868/3.m3u8', method: 'hls', color: 'green' },
    { name: '08. Nasim', url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226653/index.m3u8', method: 'hls', color: 'green' },
    { name: '09. Varzesh', url: 'https://lenz.splus.ir/PLTV/88888888/224/3221226845/3.m3u8', method: 'hls', color: 'green' },
    { name: '10. iFilm Farsi', url: 'https://live.presstv.ir/hls/ifilmfa.m3u8', method: 'hls', color: 'blue' }
  ];

  let hlsInst = null;
  let cur = null;
  let proxyBase = '';

  function render() {
    let html = '<div class="category-title">Nationella kanaler</div>';
    
    channels.forEach(ch => {
      const activeClass = (cur && cur.url === ch.url) ? ' active' : '';
      html += `<div class="channel-item${activeClass}" onclick="play('${ch.url}','${ch.name}','${ch.method}')">${ch.name}</div>`;
    });
    
    document.getElementById('ch-container').innerHTML = html;
  }

  function play(url, name, method) {
    cur = {url, name, method};
    document.getElementById('ch-title').textContent = name;

    if (hlsInst) { hlsInst.destroy(); hlsInst = null; }

    const wrap = document.getElementById('vwrap');

    if (method === 'iframe') {
      wrap.innerHTML = `<iframe src="${url}" allowfullscreen allow="autoplay; fullscreen" style="width:100%; height:100%;"></iframe>`;
      render();
      return;
    }

    wrap.innerHTML = '<video id="vplayer" controls autoplay style="width:100%;height:100%;"></video>';
    const vid = document.getElementById('vplayer');

    const streamUrl = proxyUrl(url);

    if (Hls.isSupported()) {
      hlsInst = new Hls();
      hlsInst.loadSource(streamUrl);
      hlsInst.attachMedia(vid);
      hlsInst.on(Hls.Events.MANIFEST_PARSED, () => vid.play().catch(()=>{}));
      hlsInst.on(Hls.Events.ERROR, (_, data) => {
        if (data.fatal) {
          wrap.innerHTML = `<div class="error-msg"><h3>‚ö†Ô∏è Fel: ${data.type}</h3><button class="btn" onclick="reload()">F√∂rs√∂k igen</button></div>`;
        }
      });
    } else if (vid.canPlayType('application/vnd.apple.mpegurl')) {
      vid.src = streamUrl;
      vid.play().catch(() => {
        wrap.innerHTML = '<div class="error-msg"><h3>‚ö†Ô∏è Kunde inte spela</h3></div>';
      });
    } else {
      wrap.innerHTML = '<div class="error-msg"><h3>‚ö†Ô∏è HLS st√∂ds inte</h3></div>';
    }
    render();
  }

  function proxyUrl(url) {
    if (!proxyBase) return url;
    if (proxyBase.includes('?url=')) return proxyBase + encodeURIComponent(url);
    return proxyBase + url;
  }

  function updateProxy() {
    proxyBase = document.getElementById('proxy-url').value.trim();
    const st = document.getElementById('proxy-status');
    st.textContent = proxyBase ? 'Aktiv' : 'Av';
    st.className = proxyBase ? 'proxy-status on' : 'proxy-status off';
  }

  function setPreset(key) {
    const presets = {
      'cors-anywhere': 'https://cors-anywhere.herokuapp.com/',
      'allorigins': 'https://api.allorigins.win/raw?url='
    };
    document.getElementById('proxy-url').value = presets[key] || '';
    updateProxy();
  }

  function clearProxy() {
    document.getElementById('proxy-url').value = '';
    updateProxy();
  }

  function reload() {
    if (cur) play(cur.url, cur.name, cur.method);
  }

  // Starta
  render();
</script>
</body>
</html>
